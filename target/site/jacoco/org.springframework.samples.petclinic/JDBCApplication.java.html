<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JDBCApplication.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">petclinic</a> &gt; <a href="index.source.html" class="el_package">org.springframework.samples.petclinic</a> &gt; <span class="el_source">JDBCApplication.java</span></div><h1>JDBCApplication.java</h1><pre class="source lang-java linenums">
package org.springframework.samples.petclinic;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import org.springframework.samples.petclinic.owner.Owner;
import org.springframework.samples.petclinic.owner.Pet;

<span class="nc" id="L14">public class JDBCApplication {</span>

	public static void main(String[] args) {
<span class="nc" id="L17">		System.out.println(&quot;-------- Test de conexión con MySQL ------------&quot;);</span>

		try {
<span class="nc" id="L20">			Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</span>
		}
<span class="nc" id="L22">		catch (ClassNotFoundException e) {</span>
<span class="nc" id="L23">			System.out.println(&quot;No encuentro el driver en el Classpath&quot;);</span>
<span class="nc" id="L24">			e.printStackTrace();</span>
<span class="nc" id="L25">			return;</span>
<span class="nc" id="L26">		}</span>

<span class="nc" id="L28">		System.out.println(&quot;Driver instalado y funcionando&quot;);</span>
<span class="nc" id="L29">		Connection connection = null;</span>
<span class="nc" id="L30">		Statement statement = null;</span>
		try {
<span class="nc" id="L32">			connection = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/petclinic&quot;, &quot;root&quot;, &quot;root&quot;);</span>
<span class="nc bnc" id="L33" title="All 2 branches missed.">			if (connection != null)</span>
<span class="nc" id="L34">				System.out.println(&quot;Conexión establecida&quot;);</span>
<span class="nc" id="L35">			statement = connection.createStatement();</span>
<span class="nc" id="L36">			String sql = &quot;Select * from owners&quot;;</span>
<span class="nc" id="L37">			ResultSet rs = statement.executeQuery(sql);</span>

			// PreparedStatement copiado en clase
<span class="nc" id="L40">			sql = &quot;SELECT * FROM owners WHERE first_name LIKE ? OR last_name LIKE ?&quot;;</span>
<span class="nc" id="L41">			String busqueda = &quot;D&quot;;</span>
<span class="nc" id="L42">			String termino = &quot;%&quot; + busqueda + &quot;%&quot;;</span>
<span class="nc" id="L43">			PreparedStatement preparedStatement = connection.prepareStatement(sql);</span>
<span class="nc" id="L44">			preparedStatement.setString(1, busqueda);</span>
<span class="nc" id="L45">			preparedStatement.setString(2, termino);</span>
<span class="nc" id="L46">			rs = preparedStatement.executeQuery();</span>
<span class="nc" id="L47">			System.out.println(&quot;----PreparedStatement clase----&quot;);</span>
<span class="nc bnc" id="L48" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L49">				int id = rs.getInt(&quot;id&quot;);</span>
<span class="nc" id="L50">				String firstName = rs.getString(&quot;first_name&quot;);</span>
<span class="nc" id="L51">				String lastName = rs.getString(&quot;last_name&quot;);</span>
<span class="nc" id="L52">				System.out.print(&quot;Id: &quot; + id);</span>
<span class="nc" id="L53">				System.out.print(&quot;, Nombre: &quot; + firstName);</span>
<span class="nc" id="L54">				System.out.println(&quot;, Apellidos: &quot; + lastName);</span>
<span class="nc" id="L55">			}</span>

<span class="nc" id="L57">			rs.close();</span>

			// Reto

<span class="nc" id="L61">			Owner o = new Owner();</span>
<span class="nc" id="L62">			o.setFirstName(&quot;Carlos&quot;);</span>
<span class="nc" id="L63">			o.setLastName(&quot;Villarino&quot;);</span>
<span class="nc" id="L64">			o.setAddress(&quot;Una calle por ahí&quot;);</span>
<span class="nc" id="L65">			o.setTelephone(&quot;607753906&quot;);</span>
<span class="nc" id="L66">			o.setCity(&quot;Salamanca&quot;);</span>

			// Mi mascota
<span class="nc" id="L69">			Pet p = new Pet();</span>
<span class="nc" id="L70">			p.setName(&quot;Mico&quot;);</span>
<span class="nc" id="L71">			p.setOwner(o);</span>
<span class="nc" id="L72">			o.addPet(p);</span>

<span class="nc" id="L74">			statement = connection.createStatement();</span>
<span class="nc" id="L75">			String n = o.getFirstName();</span>
<span class="nc" id="L76">			String l = o.getLastName();</span>
<span class="nc" id="L77">			String a = o.getAddress();</span>
<span class="nc" id="L78">			String c = o.getCity();</span>
<span class="nc" id="L79">			String t = o.getTelephone();</span>

<span class="nc" id="L81">			String sql2 = &quot;INSERT INTO owners (first_name, last_name, address, city, telephone)&quot; + &quot;VALUES ('&quot; + n</span>
					+ &quot;', '&quot; + l + &quot;', '&quot; + a + &quot;', '&quot; + c + &quot;', '&quot; + t + &quot;')&quot;;
<span class="nc" id="L83">			statement.executeUpdate(sql2);</span>

			// Sacamos por pantalla los datos de la nueva identidad creada

<span class="nc" id="L87">			System.out.println(&quot;----Reto 3----&quot;);</span>
<span class="nc" id="L88">			statement = connection.createStatement();</span>
<span class="nc" id="L89">			String sql4 = &quot;SELECT * FROM owners WHERE last_name LIKE ?&quot;;</span>
<span class="nc" id="L90">			String surname = &quot;Villarino&quot;;</span>
<span class="nc" id="L91">			PreparedStatement preparedStatement2 = connection.prepareStatement(sql4);</span>
<span class="nc" id="L92">			preparedStatement2.setString(1, surname);</span>
<span class="nc" id="L93">			rs = preparedStatement2.executeQuery();</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L95">				int id = rs.getInt(&quot;id&quot;);</span>
<span class="nc" id="L96">				String firstName = rs.getString(&quot;first_name&quot;);</span>
<span class="nc" id="L97">				String lstName = rs.getString(&quot;last_name&quot;);</span>
<span class="nc" id="L98">				String adress = rs.getString(&quot;address&quot;);</span>
<span class="nc" id="L99">				String telephone = rs.getString(&quot;telephone&quot;);</span>
<span class="nc" id="L100">				String city = rs.getString(&quot;city&quot;);</span>
<span class="nc" id="L101">				System.out.println(&quot;Id: &quot; + id + &quot; &quot; + &quot;Nombre: &quot; + firstName + &quot; &quot; + &quot;Apellido: &quot; + &quot; &quot; + lstName + &quot; &quot;</span>
						+ &quot;Dirección: &quot; + &quot; &quot; + adress + &quot; &quot; + &quot;Teléfono: &quot; + &quot; &quot; + telephone + &quot; &quot; + &quot;Ciudad: &quot; + &quot; &quot;
						+ city);
<span class="nc" id="L104">			}</span>
<span class="nc" id="L105">			rs.close();</span>

<span class="nc" id="L107">			sql = &quot;DELETE FROM owners WHERE last_name = 'Villarino'&quot;;</span>
<span class="nc" id="L108">			statement.executeUpdate(sql);</span>

		}
<span class="nc" id="L111">		catch (SQLException e) {</span>
<span class="nc" id="L112">			System.out.println(&quot;Connection Failed! Check output console&quot;);</span>
<span class="nc" id="L113">			e.printStackTrace();</span>
<span class="nc" id="L114">			return;</span>
		}
		finally {
			try {
<span class="nc bnc" id="L118" title="All 2 branches missed.">				if (statement != null)</span>
<span class="nc" id="L119">					connection.close();</span>
			}
<span class="nc" id="L121">			catch (SQLException se) {</span>

<span class="nc" id="L123">			}</span>
			try {
<span class="nc bnc" id="L125" title="All 2 branches missed.">				if (connection != null)</span>
<span class="nc" id="L126">					connection.close();</span>
			}
<span class="nc" id="L128">			catch (SQLException se) {</span>
<span class="nc" id="L129">				se.printStackTrace();</span>
<span class="nc" id="L130">			}</span>
		}
<span class="nc" id="L132">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>